<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen OSIS PRO - Final Transparan</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #3b82f6;
            --accent: #60a5fa;
            --bg-gradient: linear-gradient(135deg, #0f172a, #1e3a8a);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-color: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: var(--bg-gradient);
            color: var(--text-color);
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            overflow-x: hidden;
            padding-bottom: 50px;
        }

        /* Container */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Card Glassmorphism */
        .card {
            background: rgba(30, 58, 138, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Elements */
        h1, h2, h3 { text-align: center; margin-bottom: 20px; text-transform: capitalize; }
        
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; margin-top: 10px;}
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            outline: none;
            transition: 0.3s;
        }

        input:focus, textarea:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--secondary);
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 12px;
            background: var(--secondary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .btn:hover { background: var(--accent); transform: translateY(-2px); }
        .btn:active { transform: scale(0.98); }
        
        .btn-danger { background: #ef4444; }
        .btn-success { background: #22c55e; }
        .btn-warning { background: #f59e0b; color: black; }
        .btn-back { background: transparent; border: 1px solid white; margin-bottom: 15px; width: auto; padding: 8px 15px;}
        .btn-small { width: auto; padding: 5px 10px; font-size: 0.8rem; margin-top: 0;}

        /* Grid Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .menu-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--secondary);
            transform: translateY(-5px);
        }

        .menu-item i { font-size: 2rem; margin-bottom: 10px; color: var(--accent); }
        .menu-item span { font-size: 0.85rem; font-weight: 600; line-height: 1.2;}

        /* Helpers & List Styles */
        .hidden { display: none; }
        .list-item { 
            background: rgba(0,0,0,0.25); 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-left: 4px solid var(--secondary);
        }
        
        /* History Item Style */
        .history-item {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid #f59e0b;
        }
        .history-item small { color: #aaa; display: block; margin-bottom: 5px;}
        .history-item p { margin: 5px 0; font-size: 0.9rem; color: #ddd; font-style: italic;}
        
        .deadline-card { padding: 15px; margin-bottom: 10px; border-radius: 12px; border-left: 6px solid white; background: rgba(0,0,0,0.2); }
        .deadline-done { opacity: 0.6; text-decoration: line-through; border-left-color: #22c55e !important; }

        .doc-card {
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: 0.3s;
        }
        .doc-card:hover { transform: scale(1.02); background: rgba(255,255,255,0.15); }
        .doc-icon { font-size: 2rem; float: left; margin-right: 15px; color: #f59e0b; }

    </style>
</head>
<body>

<div class="container">

    <div id="page-login" class="card">
        <h2>Sistem OSIS PRO</h2>
        <p style="text-align: center; margin-bottom: 20px; opacity: 0.8;">Portal Manajemen Terpadu</p>
        
        <label>Nama Pengguna</label>
        <input type="text" id="login-name" placeholder="Siapa nama Anda?">

        <label>Jabatan</label>
        <select id="login-role" onchange="checkRoleInputs()">
            <option value="Anggota">Anggota</option>
            <option value="Bendahara">Bendahara</option>
            <option value="Ketua">Ketua</option>
        </select>

        <div id="password-container" class="hidden">
            <label>Password</label>
            <div style="position: relative;">
                <input type="password" id="login-pass" placeholder="Password khusus">
                <i class="fas fa-eye" onclick="togglePass()" style="position: absolute; right: 15px; top: 15px; cursor: pointer;"></i>
            </div>
        </div>

        <button class="btn" onclick="handleLogin()">Masuk Portal <i class="fas fa-arrow-right"></i></button>
    </div>

    <div id="page-dashboard" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h3 style="text-align: left; margin:0; font-size:1.5rem;">Halo, <span id="display-name">User</span></h3>
                <small id="display-role" style="color: var(--accent); font-weight:bold;">Anggota</small>
            </div>
            <button onclick="logout()" style="background:none; border:none; color:white; cursor:pointer;"><i class="fas fa-sign-out-alt fa-lg"></i></button>
        </div>

        <div class="dashboard-grid">
            <div class="menu-item" onclick="nav('page-laporan-tugas')">
                <i class="fas fa-clipboard-check"></i>
                <span>Laporan Tugas</span>
            </div>
            <div class="menu-item" onclick="nav('page-poin')">
                <i class="fas fa-star"></i>
                <span>Lihat Poin</span>
            </div>
            <div class="menu-item" onclick="nav('page-keuangan')">
                <i class="fas fa-wallet"></i>
                <span>Keuangan</span>
            </div>
            <div class="menu-item" onclick="nav('page-deadline')">
                <i class="fas fa-hourglass-half"></i>
                <span>Deadline Tugas</span>
            </div>
            <div class="menu-item" onclick="nav('page-divisi')">
                <i class="fas fa-users-cog"></i>
                <span>Tugas Anggota</span>
            </div>
            <div class="menu-item" onclick="nav('page-dokumentasi')">
                <i class="fas fa-camera-retro"></i>
                <span>Hasil Dokumentasi</span>
            </div>
            <div class="menu-item" onclick="nav('page-acara-selesai')">
                <i class="fas fa-flag-checkered"></i>
                <span>Acara Selesai</span>
            </div>
            <div class="menu-item" onclick="nav('page-notulensi')">
                <i class="fas fa-book"></i>
                <span>Notulensi</span>
            </div>
            <div class="menu-item" onclick="nav('page-report')">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Report/Aduan</span>
            </div>
            <div class="menu-item" id="btn-background" onclick="nav('page-background')">
                <i class="fas fa-image"></i>
                <span>Background</span>
            </div>
            <div class="menu-item" onclick="nav('page-juknis')">
                <i class="fas fa-info-circle"></i>
                <span>Juknis</span>
            </div>
        </div>
    </div>

    <div id="page-laporan-tugas" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Laporan Tugas</h3>
        <label>Nama Osis</label>
        <input type="text" id="tugas-nama" readonly style="opacity: 0.7;">
        <label>Tugas yang diselesaikan (Penyebab Poin Bertambah)</label>
        <textarea id="tugas-desc" rows="3" placeholder="Contoh: Menyelesaikan dekorasi panggung..."></textarea>
        <button class="btn" onclick="submitTugas()">Kirim & Dapat Poin</button>
    </div>

    <div id="page-poin" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Klasemen Poin</h3>
        <div id="poin-list" style="margin-top:20px; max-height: 200px; overflow-y:auto;"></div>
        
        <hr style="border-color: rgba(255,255,255,0.2); margin: 20px 0;">
        
        <h3>Riwayat Aktivitas</h3>
        <p style="text-align:center; font-size:0.8rem; opacity:0.7; margin-bottom:10px;">(Log penambahan poin)</p>
        <div id="poin-history" style="max-height: 300px; overflow-y:auto;">
            </div>
    </div>

    <div id="page-keuangan" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Laporan Keuangan</h3>
        
        <div style="text-align: center; margin-bottom: 20px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
            <small>Total Kas Saat Ini</small>
            <h2 id="saldo-total" style="font-size: 2rem; color: #4ade80;">Rp 0</h2>
        </div>

        <div id="keuangan-form" class="hidden">
            <label>Keterangan</label>
            <input type="text" id="keuangan-ket">
            <label>Jumlah Uang (Rp)</label>
            <input type="number" id="keuangan-jml">
            <label>Jenis Transaksi</label>
            <select id="keuangan-tipe">
                <option value="masuk">Pemasukan (+)</option>
                <option value="keluar">Pengeluaran (-)</option>
            </select>
            <button class="btn" onclick="submitKeuangan()">Kirim Laporan</button>
        </div>
        <div style="margin-top: 20px;" id="keuangan-list"></div>
    </div>

    <div id="page-deadline" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Deadline Tugas</h3>
        
        <div id="deadline-form" class="hidden">
            <label>Keterangan Tugas</label>
            <input type="text" id="dl-ket">
            <label>Tanggal Deadline</label>
            <input type="date" id="dl-tgl">
            <label>Warna Penanda</label>
            <input type="color" id="dl-color" value="#ef4444" style="height: 50px; cursor: pointer;">
            <button class="btn" onclick="submitDeadline()">Publikasi Deadline</button>
        </div>
        
        <div id="deadline-list" style="margin-top: 20px;"></div>
    </div>

    <div id="page-dokumentasi" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Hasil Dokumentasi</h3>

        <div id="doc-form" class="hidden" style="margin-bottom: 20px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
            <h4 style="margin-bottom:10px; color:var(--accent)">Tambah Dokumentasi (Ketua)</h4>
            <label>Nama Acara</label>
            <input type="text" id="doc-nama">
            <label>Tanggal Pelaksanaan</label>
            <input type="date" id="doc-tgl">
            <label>Link (Gdrive/Youtube)</label>
            <input type="text" id="doc-link" placeholder="https://...">
            <button class="btn" onclick="submitDokumentasi()">Simpan Dokumentasi</button>
        </div>

        <div id="doc-list"></div>
    </div>

    <div id="page-acara-selesai" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Arsip Acara Selesai</h3>

        <div id="finished-form" class="hidden" style="margin-bottom: 20px;">
            <label>Deskripsi Acara Selesai</label>
            <textarea id="finished-desc" rows="5" placeholder="Tulis cerita sukses acara ini..."></textarea>
            <button class="btn" onclick="submitAcaraSelesai()">Arsip Acara</button>
        </div>

        <div id="finished-list"></div>
    </div>

    <div id="page-divisi" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Pilih Divisi</h3>
        <div class="dashboard-grid">
            <button class="btn" onclick="openDivisi('Ketua Osis')">Ketua OSIS</button>
            <button class="btn" onclick="openDivisi('Wakil Ketua')">Wakil Ketua</button>
            <button class="btn" onclick="openDivisi('Bendahara')">Bendahara</button>
            <button class="btn" onclick="openDivisi('Sekertaris')">Sekertaris</button>
            <button class="btn" onclick="openDivisi('Logistik')">Logistik</button>
            <button class="btn" onclick="openDivisi('Humas')">Humas</button>
            <button class="btn" onclick="openDivisi('Acara')">Acara</button>
            <button class="btn" onclick="openDivisi('PDD')">PDD</button>
            <button class="btn" onclick="openDivisi('Keamanan')">Keamanan</button>
        </div>
    </div>

    <div id="page-detail-divisi" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-divisi')">Kembali</button>
        <h3 id="divisi-title">Tugas Divisi</h3>
        <div id="divisi-editor" class="hidden">
            <textarea id="divisi-input" rows="5"></textarea>
            <button class="btn" onclick="saveDivisi()">Simpan Jobdesk</button>
        </div>
        <div id="divisi-view" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; min-height: 100px; white-space: pre-wrap;"></div>
    </div>

    <div id="page-notulensi" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Notulensi Rapat</h3>
        <div id="notulensi-form">
            <label>Judul</label>
            <input type="text" id="notulensi-judul">
            <label>Tanggal</label>
            <input type="date" id="notulensi-tgl">
            <label>Isi Notulensi</label>
            <textarea id="notulensi-isi" rows="4"></textarea>
            <button class="btn" onclick="submitNotulensi()">Kirim Notulensi</button>
        </div>
        <div id="notulensi-list" style="margin-top: 20px;"></div>
    </div>

    <div id="page-juknis" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Juknis Anggota</h3>
        <div id="juknis-content" style="margin-bottom: 20px;"></div>
        <button id="btn-edit-juknis" class="btn hidden" onclick="editJuknis()">Edit Juknis</button>
    </div>

    <div id="page-report" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Report & Aduan</h3>
        <label>Isi Aduan (Rahasia)</label>
        <textarea id="report-isi" rows="4"></textarea>
        <button class="btn" onclick="sendReport()">Kirim ke Ketua</button>
        <div id="report-list-container" class="hidden" style="margin-top: 20px;">
            <h4>Laporan Masuk</h4>
            <div id="report-list"></div>
        </div>
    </div>

    <div id="page-background" class="card hidden">
        <button class="btn btn-back" onclick="nav('page-dashboard')">Kembali</button>
        <h3>Ganti Background</h3>
        <input type="file" id="bg-file" accept="image/*">
        <button class="btn" onclick="changeBackground()">Ganti Background</button>
        <button class="btn btn-warning" onclick="resetBackground()">Reset Default</button>
    </div>

</div>

<script>
    // --- DATABASE & STATE ---
    const DB_KEY = 'osis_pro_final_v3'; // Update Key biar fresh
    
    let db = JSON.parse(localStorage.getItem(DB_KEY)) || {
        users: [], 
        tasks: [], // {id, name, desc, date}
        finance: [], 
        minutes: [], 
        deadlines: [], 
        divisi: {}, 
        juknis: ["Datang kumpulan tepat waktu", "Selalu mengerjakan tugas", "Menjaga etika", "Lapor jika absen"],
        reports: [], 
        docs: [],
        finishedEvents: [],
        customBg: null
    };

    let currentUser = null;
    let currentRole = null;
    let currentDivisiEditing = null;

    function saveDB() {
        localStorage.setItem(DB_KEY, JSON.stringify(db));
    }

    // --- INIT ---
    window.onload = function() {
        if(db.customBg) document.body.style.backgroundImage = `url(${db.customBg})`;
    };

    // --- NAVIGATION ---
    function nav(pageId) {
        document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
        document.getElementById(pageId).classList.remove('hidden');
        
        if(pageId === 'page-poin') renderPoin();
        if(pageId === 'page-keuangan') renderKeuangan();
        if(pageId === 'page-notulensi') renderNotulensi();
        if(pageId === 'page-deadline') renderDeadline();
        if(pageId === 'page-juknis') renderJuknis();
        if(pageId === 'page-report') renderReport();
        if(pageId === 'page-dokumentasi') renderDokumentasi();
        if(pageId === 'page-acara-selesai') renderAcaraSelesai();
        if(pageId === 'page-laporan-tugas') {
            document.getElementById('tugas-nama').value = currentUser;
        }
    }

    // --- LOGIN ---
    function checkRoleInputs() {
        const role = document.getElementById('login-role').value;
        const passContainer = document.getElementById('password-container');
        passContainer.classList.toggle('hidden', role === 'Anggota');
    }

    function togglePass() {
        const input = document.getElementById('login-pass');
        input.type = input.type === 'password' ? 'text' : 'password';
    }

    function handleLogin() {
        const name = document.getElementById('login-name').value;
        const role = document.getElementById('login-role').value;
        const pass = document.getElementById('login-pass').value;

        if (!name) return alert("Nama wajib diisi!");
        if (role === 'Bendahara' && pass !== 'bendahara321') return alert("Password Salah!");
        if (role === 'Ketua' && pass !== 'Ketua 315') return alert("Password Salah!");

        currentUser = name;
        currentRole = role;

        let userExists = db.users.find(u => u.name === name);
        if(!userExists) {
            db.users.push({name: name, points: 0});
            saveDB();
        }

        document.getElementById('display-name').innerText = name;
        document.getElementById('display-role').innerText = role;
        document.getElementById('btn-background').style.display = (role === 'Ketua') ? 'flex' : 'none';

        nav('page-dashboard');
    }

    function logout() { location.reload(); }

    // --- 1. POIN & TUGAS (UPDATED HISTORY) ---
    function submitTugas() {
        const desc = document.getElementById('tugas-desc').value;
        if(!desc) return alert("Isi deskripsi tugas!");

        // 1. Tambah Poin
        let userIndex = db.users.findIndex(u => u.name === currentUser);
        if (userIndex === -1) {
            db.users.push({name: currentUser, points: 0});
            userIndex = db.users.length - 1;
        }
        db.users[userIndex].points += 1;
        
        // 2. Simpan Log (Riwayat)
        db.tasks.push({
            id: Date.now(),
            name: currentUser,
            desc: desc,
            date: new Date().toLocaleString()
        });

        saveDB();
        
        document.getElementById('tugas-desc').value = '';
        alert(`Laporan Diterima! Poin +1`);
        nav('page-dashboard');
    }

    function renderPoin() {
        // A. Render Klasemen
        const list = document.getElementById('poin-list');
        list.innerHTML = '';
        const sortedUsers = [...db.users].sort((a,b) => b.points - a.points);
        sortedUsers.forEach((u, index) => {
            if(u.points >= 0) {
                list.innerHTML += `
                <div class="list-item">
                    <span><b>#${index+1}</b> ${u.name}</span>
                    <span style="font-weight:bold; color:#fbbf24; font-size:1.2rem;">${u.points} <i class="fas fa-star"></i></span>
                </div>
                ${currentRole === 'Ketua' ? `<button onclick="kurangiPoin('${u.name}')" class="btn btn-danger btn-small" style="margin-bottom:10px;">Hapus Curang</button>` : ''}
                `;
            }
        });

        // B. Render Riwayat (History)
        const historyList = document.getElementById('poin-history');
        historyList.innerHTML = '';
        
        // Urutkan tugas dari yang paling baru (Descending ID)
        const logs = [...db.tasks].sort((a,b) => b.id - a.id);
        
        if(logs.length === 0) {
            historyList.innerHTML = '<p style="text-align:center; opacity:0.5;">Belum ada aktivitas.</p>';
        } else {
            logs.forEach(log => {
                historyList.innerHTML += `
                <div class="history-item">
                    <div style="display:flex; justify-content:space-between;">
                        <span style="font-weight:bold; color:var(--accent);">${log.name}</span>
                        <span style="color:#22c55e; font-size:0.8rem; font-weight:bold;">+1 Poin</span>
                    </div>
                    <p>"${log.desc}"</p>
                    <small>${log.date}</small>
                </div>
                `;
            });
        }
    }

    function kurangiPoin(targetName) {
        if(!confirm(`Kurangi poin ${targetName}?`)) return;
        let user = db.users.find(u => u.name === targetName);
        if(user && user.points > 0) {
            user.points -= 1;
            saveDB();
            renderPoin();
        }
    }

    // --- 2. DEADLINE (KETUA BISA HAPUS) ---
    function renderDeadline() {
        const form = document.getElementById('deadline-form');
        form.classList.toggle('hidden', currentRole !== 'Ketua');
        const list = document.getElementById('deadline-list');
        list.innerHTML = '';

        db.deadlines.forEach(d => {
            const isDoneClass = d.isDone ? 'deadline-done' : '';
            const adminControls = currentRole === 'Ketua' ? `<button onclick="deleteDeadline(${d.id})" class="btn-danger btn-small" style="float:right; margin-left:5px;"><i class="fas fa-trash"></i></button>` : '';
            const btnSelesai = !d.isDone ? `<button onclick="toggleDeadline(${d.id})" class="btn-success btn-small" style="float:right;">Selesai</button>` : '';

            list.innerHTML += `
            <div class="deadline-card ${isDoneClass}" style="border-left-color: ${d.color};">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong>${d.ket}</strong>
                    <div>${btnSelesai}${adminControls}</div>
                </div>
                <small>${d.date}</small>
            </div>`;
        });
    }

    function submitDeadline() {
        const ket = document.getElementById('dl-ket').value;
        const tgl = document.getElementById('dl-tgl').value;
        const color = document.getElementById('dl-color').value;
        if(!ket || !tgl) return alert("Lengkapi data!");
        
        db.deadlines.push({ id: Date.now(), ket, date: tgl, color, isDone: false });
        saveDB(); renderDeadline();
    }
    function toggleDeadline(id) { let item = db.deadlines.find(d => d.id === id); if(item) { item.isDone = true; saveDB(); renderDeadline(); } }
    function deleteDeadline(id) { if(confirm("Hapus deadline?")) { db.deadlines = db.deadlines.filter(d => d.id !== id); saveDB(); renderDeadline(); } }

    // --- 3. DOKUMENTASI ---
    function renderDokumentasi() {
        const form = document.getElementById('doc-form');
        form.classList.toggle('hidden', currentRole !== 'Ketua');
        const list = document.getElementById('doc-list');
        list.innerHTML = '';

        db.docs.forEach(doc => {
            const deleteBtn = currentRole === 'Ketua' ? `<button onclick="deleteDoc(event, ${doc.id})" class="btn-danger btn-small" style="margin-top:10px; width:100%;">Hapus</button>` : '';
            list.innerHTML += `
            <div class="doc-card" onclick="window.open('${doc.link}', '_blank')">
                <i class="fas fa-folder-open doc-icon"></i>
                <div style="overflow:hidden;">
                    <h4 style="margin:0;">${doc.nama}</h4>
                    <small style="color:var(--accent);">${doc.tgl}</small>
                    <p style="font-size:0.8rem; margin-top:5px; opacity:0.7;">Klik untuk melihat dokumentasi</p>
                </div>
                ${deleteBtn}
            </div>`;
        });
    }
    function submitDokumentasi() {
        const nama = document.getElementById('doc-nama').value;
        const tgl = document.getElementById('doc-tgl').value;
        const link = document.getElementById('doc-link').value;
        if(!nama || !link) return alert("Data kurang lengkap!");
        db.docs.push({ id: Date.now(), nama, tgl, link });
        saveDB(); renderDokumentasi(); document.getElementById('doc-nama').value=''; document.getElementById('doc-link').value='';
    }
    function deleteDoc(e, id) { e.stopPropagation(); if(confirm("Hapus?")) { db.docs = db.docs.filter(d => d.id !== id); saveDB(); renderDokumentasi(); } }

    // --- 4. ACARA SELESAI ---
    function renderAcaraSelesai() {
        const form = document.getElementById('finished-form');
        form.classList.toggle('hidden', currentRole !== 'Ketua');
        const list = document.getElementById('finished-list');
        list.innerHTML = '';
        db.finishedEvents.forEach(ev => {
            list.innerHTML += `
            <div class="list-item" style="display:block;">
                <p style="white-space: pre-wrap;">${ev.desc}</p>
                <hr style="border-color:rgba(255,255,255,0.1); margin:10px 0;">
                <small style="opacity:0.6;">Diarsipkan: ${ev.date}</small>
                ${currentRole === 'Ketua' ? `<button onclick="deleteAcara(${ev.id})" class="btn-danger btn-small" style="float:right;">Hapus</button><div style="clear:both;"></div>` : ''}
            </div>`;
        });
    }
    function submitAcaraSelesai() {
        const desc = document.getElementById('finished-desc').value;
        if(!desc) return;
        db.finishedEvents.push({ id: Date.now(), desc, date: new Date().toLocaleDateString() });
        saveDB(); document.getElementById('finished-desc').value = ''; renderAcaraSelesai();
    }
    function deleteAcara(id) { if(confirm("Hapus arsip?")) { db.finishedEvents = db.finishedEvents.filter(e => e.id !== id); saveDB(); renderAcaraSelesai(); } }

    // --- OTHER ---
    function renderKeuangan() {
        document.getElementById('keuangan-form').classList.toggle('hidden', currentRole !== 'Bendahara');
        let total = 0; const list = document.getElementById('keuangan-list'); list.innerHTML = '';
        db.finance.forEach(f => {
            let val = parseInt(f.amount); if(f.type === 'keluar') val = -val; total += val;
            const color = f.type === 'masuk' ? '#22c55e' : '#ef4444';
            list.innerHTML += `<div class="list-item"><div><strong>${f.ket}</strong><br><small>${new Date(f.date).toLocaleDateString()}</small></div><div style="text-align:right; color:${color}; font-weight:bold;">${f.type === 'masuk' ? '+' : '-'} Rp ${parseInt(f.amount).toLocaleString()}</div>${currentRole === 'Bendahara' ? `<button onclick="delKeuangan(${f.id})" class="btn-danger btn-small" style="margin-left:10px;">X</button>` : ''}</div>`;
        });
        document.getElementById('saldo-total').innerText = `Rp ${total.toLocaleString()}`;
    }
    function submitKeuangan() {
        const ket = document.getElementById('keuangan-ket').value; const jml = document.getElementById('keuangan-jml').value; const tipe = document.getElementById('keuangan-tipe').value;
        if(!ket || !jml) return;
        db.finance.push({ id: Date.now(), ket, amount: jml, type: tipe, date: new Date() });
        saveDB(); renderKeuangan(); document.getElementById('keuangan-ket').value=''; document.getElementById('keuangan-jml').value='';
    }
    function delKeuangan(id) { if(confirm("Hapus?")) { db.finance = db.finance.filter(f => f.id !== id); saveDB(); renderKeuangan(); } }

    function renderNotulensi() {
        const list = document.getElementById('notulensi-list'); list.innerHTML = '';
        db.minutes.forEach(n => {
            list.innerHTML += `<div style="background:rgba(255,255,255,0.1); padding:10px; margin-bottom:10px; border-radius:10px;"><div onclick="this.nextElementSibling.classList.toggle('hidden')" style="cursor:pointer; font-weight:bold;">${n.title} <i class="fas fa-chevron-down" style="float:right;"></i></div><div class="hidden" style="margin-top:10px; padding-top:10px; border-top:1px solid rgba(255,255,255,0.2);"><small>${n.date}</small><p>${n.content}</p><button onclick="delNotulensi(${n.id})" class="btn-danger btn-small">Hapus</button></div></div>`;
        });
    }
    function submitNotulensi() {
        const judul = document.getElementById('notulensi-judul').value; const tgl = document.getElementById('notulensi-tgl').value; const isi = document.getElementById('notulensi-isi').value;
        if(!judul) return; db.minutes.push({ id: Date.now(), title: judul, date: tgl, content: isi }); saveDB(); renderNotulensi(); document.getElementById('notulensi-judul').value=''; document.getElementById('notulensi-isi').value='';
    }
    function delNotulensi(id) { if(confirm("Hapus?")) { db.minutes = db.minutes.filter(m => m.id !== id); saveDB(); renderNotulensi(); } }

    function openDivisi(name) { currentDivisiEditing = name; nav('page-detail-divisi'); document.getElementById('divisi-title').innerText = `Divisi: ${name}`; const content = db.divisi[name] || "Belum ada jobdesk."; document.getElementById('divisi-view').innerText = content; document.getElementById('divisi-input').value = content; document.getElementById('divisi-editor').classList.toggle('hidden', currentRole !== 'Ketua'); }
    function saveDivisi() { db.divisi[currentDivisiEditing] = document.getElementById('divisi-input').value; saveDB(); document.getElementById('divisi-view').innerText = document.getElementById('divisi-input').value; alert("Tersimpan!"); }

    function renderJuknis() { document.getElementById('juknis-content').innerHTML = '<ol style="padding-left:20px;">' + db.juknis.map(j => `<li>${j}</li>`).join('') + '</ol>'; if(currentRole === 'Ketua') document.getElementById('btn-edit-juknis').classList.remove('hidden'); }
    function editJuknis() { const res = prompt("Update Juknis (pisahkan koma):", db.juknis.join(',')); if(res) { db.juknis = res.split(','); saveDB(); renderJuknis(); } }

    function sendReport() { const isi = document.getElementById('report-isi').value; if(!isi) return; db.reports.push({ id: Date.now(), content: isi, date: new Date().toLocaleDateString() }); saveDB(); document.getElementById('report-isi').value=''; alert("Terkirim ke Ketua"); }
    function renderReport() { if(currentRole !== 'Ketua') { document.getElementById('report-list-container').classList.add('hidden'); return; } document.getElementById('report-list-container').classList.remove('hidden'); const list = document.getElementById('report-list'); list.innerHTML = ''; db.reports.forEach(r => { list.innerHTML += `<div class="list-item"><div>${r.content}</div><small>${r.date}</small></div>`; }); }

    function changeBackground() { const file = document.getElementById('bg-file').files[0]; if (file) { const reader = new FileReader(); reader.onload = function(e) { document.body.style.backgroundImage = `url(${e.target.result})`; db.customBg = e.target.result; saveDB(); }; reader.readAsDataURL(file); } }
    function resetBackground() { db.customBg = null; saveDB(); document.body.style.backgroundImage = ''; }
</script>
</body>
</html>
